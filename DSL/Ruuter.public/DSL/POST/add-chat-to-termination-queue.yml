extractRequestData:
  assign:
    chatId: "${incoming.body.chatId}"
    event: "${incoming.body.event}"
    authorRole: "${incoming.body.authorRole}"
    authorTimestamp: "${incoming.body.authorTimestamp}"
  next: updateChatStatus

updateChatStatus:
  call: http.post
  args:
    url: "[#CHATBOT_RESQL]/set-termination-status"
    body:
      chatId: ${chatId}
      scheduledForTerminated: ${new Date().toISOString()}
  result: statusUpdateRes

addChatToTerminationQueue:
  call: http.post
  args:
    url: "[#CHATBOT_NOTIFICATIONS]/add-chat-to-termination-queue"
    body:
      chatId: ${chatId}
      event: ${event}
      authorRole: ${authorRole}
      authorTimestamp: ${authorTimestamp}
  result: res

return_chat_added_to_termination_queue:
  return: "Chat has added to termination queue"
  status: 200
  next: end  
